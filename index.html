<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>poeopt-rates</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; background:#0d0f12; color:#f2f3f5; font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    a { color:#8ab4ff; text-decoration:none; }
    .wrap { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
    h1 { font-weight:800; letter-spacing:.3px; margin:0 0 10px }
    small.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:#9aa3b2 }
    table { width:100%; border-collapse: collapse; margin-top:18px; }
    th, td { border-top: 1px solid #222831; padding: 10px 12px; }
    th { color:#98a2b3; font-weight:600; text-align:left; }
    .key { background:#151a21; padding:4px 10px; border-radius:999px; display:inline-block; font-weight:700; }
    .chips { display:flex; gap:6px; flex-wrap:wrap; }
    .chip { background:#131820; border:1px solid #1c2330; padding:4px 8px; border-radius:8px; font-feature-settings:"tnum"; font-variant-numeric: tabular-nums; }
    .muted { color:#9aa3b2 }
    .ok { color:#d1e9ff }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>poeopt-rates</h1>
    <small class="mono">Источник: Funpay · <a href="./rates.json">rates.json</a></small>

    <table id="tbl">
      <thead>
        <tr>
          <th style="width:200px">key</th>
          <th style="width:80px">Игра</th>
          <th style="width:220px">Валюта</th>
          <th style="width:120px">Цена, ₽</th>
          <th>ТОП-5 (₽)</th>
          <th style="width:210px">Обновлено</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    async function main() {
      const res = await fetch("./rates.json", { cache: "no-cache" });
      const data = await res.json();

      const tbody = document.querySelector("#tbl tbody");
      tbody.innerHTML = "";

      for (const [key, row] of Object.entries(data.pairs)) {
        const top = Array.isArray(row.trades_tops) ? row.trades_tops : [];
        const price = Number.isFinite(row.price_RUB) && row.price_RUB > 0
          ? row.price_RUB
          : (top[0] ?? 0);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><span class="key">${key}</span></td>
          <td>${row.game}</td>
          <td>${row.currency}</td>
          <td class="ok">${price.toFixed(2)}</td>
          <td><div class="chips">${
            top.length ? top.map(v => `<span class="chip">${Number(v).toFixed(2)}</span>`).join("")
                       : `<span class="muted">—</span>`
          }</div></td>
          <td class="muted">${row.updated_at || "—"}</td>
        `;
        tbody.appendChild(tr);
      }
    }
    main().catch(console.error);
  </script>
</body>
</html>
